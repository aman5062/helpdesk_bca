<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Helpdesk</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <!-- Custom JavaScript -->
    <script src="assets/js/script.js"></script>
    <!-- MD5 Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
    <style>
        #img1 {
            width: 300px;
            transition: transform .2s ease-in-out;
        }

        #img1:hover {
            transform: scale(1.055);
            cursor: zoom-in;
        }

        h3 {
            margin-left: 0 !important;
        }
    </style>
</head>
<body onload="checkLogin()">
<header class="navbar navbar-expand-md d-flex flex-wrap justify-content-center p-3 mb-2 border-bottom">
    <div class="container-fluid">
        <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <img src="assets/images/logo.png" id="imglogo">
            <span class="fs-4 mr-5 lo"><h2 class="bold-text">Helpdesk</h2></span>
        </a>
    </div>
</header>
<style>
    #welcome_msg{
        margin-top: 15vh;
        height: 20vh;
        width: 80vw;
    }
</style>
<div id="body">
    <center><br><br><br>
    <font style="font-size: 1.5rem;">Wait till app is starting...</font>
        <div style="font-size: 1rem;" >
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
        </div> <br>
        <img src="assets/images/kar_na.jpg" alt="kar_na">
    </center>
</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function checkLogin() {
        const userEmail = getCookie('user_email');
        const userYear = getCookie('user_year');
        const Username = getCookie('user_name');
    
        if (userEmail && userYear) {
            const data = {
                Name: Username,
                Email: userEmail
            };
    
            try {
                const response = await fetch('https://arambhsoftech.com/Helpdesk_bca/Helpdesk_login.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
    
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
    
                const result = await response.json();
                if (result.status === 1) {
                    redirectToPage(userYear);
                } else {
                    window.location = "nouser.html";
                }
            } catch (error) {
                console.error('Error:', error);
                document.write("An error occurred: " + error.message);
            }
        } else {
           window.location = "login.html";
        }
    }
    
    function redirectToPage(userYear) {
        switch(userYear) {
            case '1':
                window.location = "semester1/index.html";
                break;
            case '2':
                window.location = "semester3/index.html";
                break;
            case '3':
                window.location = "semester5/index.html";
                break;
            default:
                console.error('Invalid user year:', userYear);
        } 
    }
  
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1, c.length);
            }
            if (c.indexOf(nameEQ) === 0) {
                return c.substring(nameEQ.length, c.length);
            }
        }
        return null;
    }
  
    // Call checkLogin on page load or whenever needed
   
  </script>
  
</body>
</html>
